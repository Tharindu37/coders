<app-nav-bar></app-nav-bar>
<div
  class="flex w-full h-[95vh] px-1 md:px-44 bg-gradient-to-r gap-5 from-green-50 via-green-100 to-green-50 border pt-1"
>
  <!-- <div
    class="flex-1 h-[80vh] flex flex-col rounded-md overflow-hidden shadow-md border bg-white"
  > -->
  <div
    class="hidden w-1/4 bg-white border rounded-md shadow-md h-[85vh] md:overflow-hidden md:flex-col md:flex"
  >
    <div class="flex w-full h-32 overflow-hidden border rounded-t-md">
      <img
        class="w-full"
        [src]="user?.bannerURL || '../../../assets/banner.jpg'"
        alt=""
      />
    </div>
    <div
      class="self-center w-32 h-32 border rounded-full mt-[-80px] flex overflow-hidden bg-cover bg-center"
      [style.background-image]="
        'url(' + (user?.photoURL || '../../../assets/profile.png') + ')'
      "
    >
      <!-- <img
        class=""
        src="https://t4.ftcdn.net/jpg/03/64/21/11/360_F_364211147_1qgLVxv1Tcq0Ohz3FawUfrtONzz8nq3e.jpg"
        alt=""
      /> -->
    </div>
    <div class="flex flex-col items-center px-5">
      <div>
        <h1 style="margin-bottom: 0" class="text-2xl font-bold">
          {{ user?.displayName }}
        </h1>
      </div>
      <p class="text-[11px] text-center">
        {{ user?.description }}
      </p>
    </div>
    <div class="flex justify-center w-full cursor-pointer hover:text-green-600">
      <svg
        (click)="editProfile()"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="w-6 h-6"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"
        />
      </svg>
    </div>
  </div>
  <!-- Generate Answer section -->
  <div class="flex flex-col w-full h-full gap-2 p-0 md:w-2/4">
    <div class="flex w-full gap-2 p-2 bg-white rounded-md shadow-md">
      <!-- <div
        class="flex w-12 h-12 overflow-hidden bg-center bg-cover border rounded-full"
        style="
          background-image: url('https://t4.ftcdn.net/jpg/03/64/21/11/360_F_364211147_1qgLVxv1Tcq0Ohz3FawUfrtONzz8nq3e.jpg');
        "
      ></div> -->
      <form [formGroup]="textAreaForm" class="flex flex-col w-full gap-2">
        <textarea
          placeholder="Type your question..."
          class="w-full h-10 p-1 border md:h-20 focus:outline-none"
          formControlName="question"
        ></textarea>
        <button
          type="button"
          (click)="addQuestion()"
          [disabled]="textAreaForm.invalid"
          class="self-end text-white bg-gradient-to-r from-green-400 via-green-500 to-green-600 hover:bg-gradient-to-br font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2"
        >
          Generate Answer
        </button>
      </form>
    </div>
    <!-- Post Section -->
    <div class="flex-1 w-full p-1 overflow-y-auto main-panel">
      <div
        *ngFor="let post of posts; let i = index"
        class="flex flex-col w-full h-auto p-5 mb-1 bg-white border rounded-md shadow-md"
      >
        <div class="flex w-full gap-2 p-1">
          <div
            class="flex w-10 h-10 overflow-hidden bg-center bg-cover border rounded-full"
            [style.background-image]="
              'url(' +
              (post.user.photoURL || '../../../assets/profile.png') +
              ')'
            "
          ></div>
          <div class="flex-1">
            <h4 class="text-2xl" style="margin-bottom: 0">
              {{ post.user.displayName }}
            </h4>
            <p class="text-[11px]">
              {{ post.user.description | slice : 0 : 150 }} ...
            </p>
          </div>
        </div>
        <div class="flex flex-col gap-1 p-1">
          <p class="mb-5 text-sm">
            {{ post.question.question }}
          </p>
          <div class="flex items-start gap-1">
            <pre class="flex w-full overflow-x-auto">
                <code (click)="giveAnswer(post.question.id,post.question.answer[0].index,post.answer)" [ngClass]="{'bg-green-100':post.question.answer[0].status && post.answer==post.question.answer[0].index,'bg-red-100':!post.question.answer[0].status && post.answer==post.question.answer[0].index}" class="w-full p-1 border rounded-sm">{{post.question.answer[0].code}}</code>
            </pre>
          </div>
          <div class="flex items-start gap-1">
            <pre class="flex w-full overflow-x-auto">
                <code (click)="giveAnswer(post.question.id,post.question.answer[1].index,post.answer)" [ngClass]="{'bg-green-100':post.question.answer[1].status&& post.answer==post.question.answer[1].index,'bg-red-100':!post.question.answer[1].status && post.answer==post.question.answer[1].index}" class="w-full p-1 border rounded-sm">{{ post.question.answer[1].code }}</code>
            </pre>
          </div>
          <div class="flex items-start gap-1">
            <pre class="flex w-full overflow-x-auto">
                <code (click)="giveAnswer(post.question.id,post.question.answer[2].index,post.answer)" [ngClass]="{'bg-green-100':post.question.answer[2].status&& post.answer==post.question.answer[2].index,'bg-red-100':!post.question.answer[2].status && post.answer==post.question.answer[2].index}" class="w-full p-1 border rounded-sm">{{ post.question.answer[2].code }}</code>
            </pre>
          </div>
          <div class="flex items-start gap-1">
            <pre class="flex w-full overflow-x-auto">
                <code (click)="giveAnswer(post.question.id,post.question.answer[3].index,post.answer)" [ngClass]="{'bg-green-100':post.question.answer[3].status&& post.answer==post.question.answer[3].index,'bg-red-100':!post.question.answer[3].status && post.answer==post.question.answer[3].index}" class="w-full p-1 border rounded-sm">{{ post.question.answer[3].code}}</code>
            </pre>
          </div>
        </div>
      </div>
      <div
        infiniteScroll
        [infiniteScrollDistance]="2"
        [infiniteScrollThrottle]="50"
        [infiniteScrollContainer]="selector"
        [fromRoot]="true"
        (scrolled)="onScroll()"
      ></div>
    </div>
  </div>

  <div
    class="hidden p-2 overflow-hidden bg-white border rounded-md shadow-md h-[85vh] md:flex-col md:w-1/4 md:flex"
  >
    <div class="flex flex-col items-center w-full p-2 border rounded-md">
      <div class="flex justify-between w-full">
        <h5 style="margin-bottom: 0">Correct Answer :</h5>
        <h5 style="margin-bottom: 0">
          {{ marks?.correct || 0 }}
        </h5>
      </div>
      <div class="flex justify-between w-full">
        <h5 style="margin-bottom: 0">Wrong Answer :</h5>
        <h5 style="margin-bottom: 0">{{ marks?.wrong || 0 }}</h5>
      </div>
    </div>
  </div>
</div>
